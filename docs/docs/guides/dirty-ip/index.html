<!doctype html><html lang=fa-ir dir=rtl><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="بررسی کثیف نبودن IP # «لیست» و کثیفی IP # یکی از مشکلاتی که گریبانگیر کاربران شده است، پاسخ به این پرسش است که «آیا IP سرورِ اجاره‌شده کثیف (dirty) است یا نه؟»
در سامانه‌ی سانسور، گاهی اوقات یک دامنه/IP به صورت مطلق مسدود (blocked) نمی‌شود بلکه تنها گاهی کیفیت سرویس‌دهی (Quality of Service : QoS) به آن نشانی پایین می‌آید.
این افت کیفیت می‌تواند شامل موارد زیر شود:"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="آزمون کثیف نبودن IP"><meta property="og:description" content="بررسی کثیف نبودن IP # «لیست» و کثیفی IP # یکی از مشکلاتی که گریبانگیر کاربران شده است، پاسخ به این پرسش است که «آیا IP سرورِ اجاره‌شده کثیف (dirty) است یا نه؟»
در سامانه‌ی سانسور، گاهی اوقات یک دامنه/IP به صورت مطلق مسدود (blocked) نمی‌شود بلکه تنها گاهی کیفیت سرویس‌دهی (Quality of Service : QoS) به آن نشانی پایین می‌آید.
این افت کیفیت می‌تواند شامل موارد زیر شود:"><meta property="og:type" content="article"><meta property="og:url" content="https://azadzadeh.github.io/iran-internet/docs/guides/dirty-ip/"><meta property="article:section" content="docs"><title>آزمون کثیف نبودن IP | اینترنت ایران</title><link rel=manifest href=/iran-internet/manifest.json><link rel=icon href=/iran-internet/favicon.png type=image/x-icon><link rel=stylesheet href=/iran-internet/book.min.bb111fce06151c4832a363c50976a4662c646ee31a564887a56130f2ed35272a.css integrity="sha256-uxEfzgYVHEgyo2PFCXakZixkbuMaVkiHpWEw8u01Jyo=" crossorigin=anonymous><script defer src=/iran-internet/flexsearch.min.js></script>
<script defer src=/iran-internet/fa.search.min.ff2425471f3164f578ec258e2e40171019f6955cfa0ab7088ca7aa89f9e11779.js integrity="sha256-/yQlRx8xZPV47CWOLkAXEBn2lVz6CrcIjKeqifnhF3k=" crossorigin=anonymous></script>
<script defer src=/iran-internet/sw.min.c9ae79605996fd87fe28b8ce3a321877cd2bcf610687bcc944667b290c6d3ca1.js integrity="sha256-ya55YFmW/Yf+KLjOOjIYd80rz2EGh7zJRGZ7KQxtPKE=" crossorigin=anonymous></script></head><body dir=rtl><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/iran-internet/><span>اینترنت ایران</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=جستجو aria-label=جستجو maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>راهنمایی‌ها</span><ul><li><a href=/iran-internet/docs/guides/circumvention/>تکنولوژی‌های عبور از فیلترینگ</a></li><li><a href=/iran-internet/docs/guides/vps-providers/>گزینش و مقایسه‌ی ارائه‌دهندگان VPS</a></li><li><a href=/iran-internet/docs/guides/dirty-ip/ class=active>آزمون کثیف نبودن IP</a></li><li><a href=/iran-internet/docs/guides/speedtest/>آزمون سرعت و پهنای‌باند</a></li><li><a href=/iran-internet/docs/guides/unix-redirect-apps/>گذراندن ترافیک برنامه‌ها از SOCKS در لینوکس</a></li><li><a href=/iran-internet/docs/guides/sanctions/>دور زدن تحریم‌های خارجی</a></li></ul></li></ul><ul><li><a href=https://github.com/Azadzadeh/iran-internet#donation target=_blank rel=noopener>Donate</a></li><li><a href=https://azadzadeh.github.io/trojan-go/ target=_blank rel=noopener>Trojan-Go docs</a></li><li><a href=https://hysteria.network/ target=_blank rel=noopener>Hysteria docs</a></li><li><a href=https://www.v2ray.com/en/index.html target=_blank rel=noopener>V2ray docs</a></li><li><a href=https://github.com/XTLS/Xray-examples target=_blank rel=noopener>Xray examples</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/iran-internet/svg/menu.svg class=book-icon alt=Menu></label>
<strong>آزمون کثیف نبودن IP</strong>
<label for=toc-control><img src=/iran-internet/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#بررسی-کثیف-نبودن-ip>بررسی کثیف نبودن IP</a><ul><li><a href=#لیست-و-کثیفی-ip>«لیست» و کثیفی IP</a></li><li><a href=#بررسی-مسدود-نبودن-یک-دامنهآیپی>بررسی مسدود‌ نبودن یک دامنه/آی‌پی</a></li><li><a href=#بررسی-کثیف-نبودن-یک-دامنهآیپی>بررسی کثیف‌ نبودن یک دامنه/آی‌پی</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=بررسی-کثیف-نبودن-ip>بررسی کثیف نبودن IP
<a class=anchor href=#%d8%a8%d8%b1%d8%b1%d8%b3%db%8c-%da%a9%d8%ab%db%8c%d9%81-%d9%86%d8%a8%d9%88%d8%af%d9%86-ip>#</a></h1><h2 id=لیست-و-کثیفی-ip>«لیست» و کثیفی IP
<a class=anchor href=#%d9%84%db%8c%d8%b3%d8%aa-%d9%88-%da%a9%d8%ab%db%8c%d9%81%db%8c-ip>#</a></h2><p>یکی از مشکلاتی که گریبانگیر کاربران شده است، پاسخ به این پرسش است که «آیا IP سرورِ اجاره‌شده کثیف (dirty) است یا نه؟»</p><p>در <a href=https://en.wikipedia.org/wiki/Great_Firewall#Active_filtering>سامانه‌ی سانسور</a>، گاهی اوقات یک دامنه/IP به صورت مطلق مسدود (blocked) نمی‌شود بلکه تنها گاهی کیفیت سرویس‌دهی (<a href=https://en.wikipedia.org/wiki/Quality_of_service>Quality of Service : QoS</a>) به آن نشانی پایین می‌آید.</p><p>این افت کیفیت می‌تواند شامل موارد زیر شود:</p><ul><li>کاهش پهنای باند ارسالی و دریافتی از آن نشانی</li><li>قطع ناگهانی ارتباط TCP توسط شخص ثالث (<a href=https://en.wikipedia.org/wiki/TCP_reset_attack>TCP RST</a>)</li><li>زمانبَر کردن ارتباط بدون قطع کردن (timeout error)</li><li>منع دست‌دادن در جلسه‌ی امن (TLS handshake error)</li></ul><p>در صورت بروز چنین مشکلاتی (که تشخیص آن هم آسان نیست)، اصطلاحاً می‌گوییم آن نشانی اینترنتی کثیف شده است و در «لیست» رفته است.</p><p>برای مواجه‌نشدن با این مشکلات لازم است <strong>پیش از</strong> نصب و تنظیم نرم‌افزار proxy در سمت سرور، از الف: مسدود نبودن و ب: کثیف نبودن آن نشانی مطمئن شویم.</p><blockquote class="book-hint info"><p><strong>&mldr; ولی ولییی من تازه این IP رو سفارش داده‌ بودمممم! 😢</strong></p><p>دقت شود اینکه برای نخستین بار از یک دیتاسنتر یک IP اجاره کرده‌اید یا اینکه مجدداً پس از مدتی کارکردن با یک نشانی دیگر، یک IP تازه سفارش داده‌اید، نشانگر پاک بودن آن نشانی تازه نیست! چراکه آن IP نو ممکن است توسط <strong>سایر مشتریان ایرانی پیش از شما</strong> به دلایل مختلف مثل عدم استفاده از پروتکل/پراکسی امن در <em>لیست</em> سامانه‌ی سانسور ایران قرار گرفته و کثیف شده باشد!</p></blockquote><h2 id=بررسی-مسدود-نبودن-یک-دامنهآیپی>بررسی مسدود‌ نبودن یک دامنه/آی‌پی
<a class=anchor href=#%d8%a8%d8%b1%d8%b1%d8%b3%db%8c-%d9%85%d8%b3%d8%af%d9%88%d8%af-%d9%86%d8%a8%d9%88%d8%af%d9%86-%db%8c%da%a9-%d8%af%d8%a7%d9%85%d9%86%d9%87%d8%a2%db%8c%d9%be%db%8c>#</a></h2><p>کافیست از دستور <code>ping</code> یا <code>mtr</code> استفاده کنید:</p><pre dir=ltr><code>ping 123.45.67.890
</code></pre><p>اگر در خروجی بسته‌های ICMP رد و بدل نشد و ارتباط <code>ssh</code> هم نتوانستید برقرار کنید، نشانگر انسداد آن نشانی است.</p><pre dir=ltr><code>mtr -y2 my.domain.name
</code></pre><p>اگر در آخرین خط خروجی، IP تنظیم شده به آن دامنه را ندیدید، نشانگر فیلترشدن آن دامنه یا DNS poisoning است. مورد دوم موضوع مستقلی از این نوشتار است.</p><h2 id=بررسی-کثیف-نبودن-یک-دامنهآیپی>بررسی کثیف‌ نبودن یک دامنه/آی‌پی
<a class=anchor href=#%d8%a8%d8%b1%d8%b1%d8%b3%db%8c-%da%a9%d8%ab%db%8c%d9%81-%d9%86%d8%a8%d9%88%d8%af%d9%86-%db%8c%da%a9-%d8%af%d8%a7%d9%85%d9%86%d9%87%d8%a2%db%8c%d9%be%db%8c>#</a></h2><p>از آنجایی که بسیاری از روش‌های کارگر در شرایط فعلی ایران، بسان یک وبسایت تحت پروتکل HTTPS رفتار می‌کنند تا از سامانه‌ی سانسور در امان بمانند، ما نیز برای آزمایش، یک وبسایت تحت HTTPS بالا می‌آوریم و بررسی می‌کنیم که آیا یک رایانه‌ی بدون پراکسی می‌تواند آن وبسایت را ببیند یا نه؟</p><ol><li><p>ابتدا برای دامنه‌تان باید گواهی SSL را تنظیم کنید. <a href=https://github.com/iranxray/hope/blob/main/create-tsl-certificate.md#%D8%B3%D8%A7%D8%AE%D8%AA-tls-certificate>این راهنمایی</a> مفید است.</p></li><li><p>یک وبسایت بسازید.<blockquote class="book-hint warning">این بخش در سمت سرور اجرا می‌شود</blockquote></p></li></ol><p>مثلاً با اجرای دستورات زیر یک وبسایت ایستا ساخته می‌شود که برای آزمون ما کافی است.</p><pre dir=ltr><code># install hugo-extended on your server
# https://github.com/gohugoio/hugo/releases
wget "https://github.com/gohugoio/hugo/releases/download/v0.109.0/hugo_extended_0.109.0_linux-amd64.deb"
sudo apt install ./hugo_extended_0.109.0_linux-amd64.deb

# make sure it's installed and available
hugo version

# create a dir for dummy website
mkdir -p "$HOME/dummy-website"

# choose a theme from here https://themes.gohugo.io, for example:
git clone https://github.com/kc0bfv/autophugo "$HOME/dummy-website/autophugo"
cd "$HOME/dummy-website/autophugo/exampleSite"

# edit config.toml to use your domain name (e.g. my.domain.name):
sed -i 's/example\.org/my\.domain\.name/g' config.toml

rm -rf $HOME/dummy-website/autophugo/exampleSite/public/
hugo --themesDir "../.."
</code></pre><ol start=3><li>وبسایت را روی پورت ۴۴۳ تحت HTTP<strong>S</strong> بالا بیاورید.<blockquote class="book-hint warning">این بخش در سمت سرور اجرا می‌شود</blockquote></li></ol><p>مثلاً می‌توانید از Caddy که یک HTTP Web Server است استفاده کنید یا هر روش دیگری که بلدید (nginx, Apache, etc).</p><pre dir=ltr><code># install caddy on your server
# https://caddyserver.com/docs/install
sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | sudo tee /etc/apt/sources.list.d/caddy-stable.list
sudo apt update
sudo apt install caddy

# make sure it's installed and available
caddy version

caddy file-server --domain my.domain.name --root $HOME/dummy-website/autophugo/exampleSite/public/
</code></pre><blockquote class="book-hint warning"><p>دقت کنید که باید پورت ۸۰ و ۴۴۳ برای دستور بالا باز باشد وگرنه اجرا نمی‌شود.
برای اینکه بفهمید کدام برنامه در حال اشغال چه پورتی است:
(محدود به TCP)</p><pre dir=ltr><code>netstat -nlpt
</code></pre><p>سپس برنامه‌ی اشغالگر را برای اجرای آزمون موقتاً متوقف کنید.</p></blockquote><ol start=4><li>بدترین شبکه‌ و ISP-ای که می‌شناسید را برگزینید (معمولاً اپراتورهای موبایل فیلترینگ سختگیرانه‌تری دارند)</li></ol><p>مثلاً اگر تست را روی رایانه انجام می‌دهید، سیستم عامل باید به اینترنت گوشی همراه وصل باشد.</p><ol start=5><li>روی اینترنت شبکه‌ی برگزیده، بدون هیچ پراکسی و VPNی یک HTTP load teser را علیه وبسایتی که بالا آورده‌اید، اجرا کنید<blockquote class="book-hint warning">این بخش در سمت client (نه سرور) اجرا ‌می‌شود</blockquote></li></ol><p><a href=https://github.com/denji/awesome-http-benchmark#https-benchmark-tools>گزینه‌های بسیاری</a> برای این امر وجود دارد.
مثلاً ما اینجا از <a href=https://github.com/hatoo/oha>oha</a> استفاده می‌کنیم که یک رابط کاربری تحت console هم دارد و روند تست بار را به صورت انیمیشن نمایش می‌دهد.</p><p><img src=/iran-internet/docs/guides/oha-demo.gif alt="oha demo"></p><pre dir=ltr><code># install oha on your client
# https://github.com/hatoo/oha/releases
wget -P /tmp/ "https://github.com/hatoo/oha/releases/download/v0.5.5/oha-linux-amd64"
chmod +x /tmp/oha-linux-amd64
mv /tmp/oha-linux-amd64 "$HOME/.local/bin/oha"

# make sure it's installed and available
oha --version

# baseline benchmark of a local website (should be fast)
oha https://telewebion.com -n 20 -c 3 -t 10sec

# typical foreign-hosted website
oha https://en.wikipedia.org/wiki/Tcpip -n 20 -c 3 -t 10sec

# our dummy website on our domain
oha https://my.domain.name -n 20 -c 3 -t 10sec
</code></pre><ul><li><p>برای هر وبسایت تست، ۲۰ درخواست می‌فرستیم چراکه ما می‌خواهیم کیفیت دسترسی به سایت در شبکه را بیازماییم نه تکنولوژی وب-سرور یا سنگینی سایت را.</p></li><li><p>بیشینه تعداد کارگرهایی که در هر زمان درخواست می‌کنند را به عدد ۳ محدود می‌کنیم</p></li></ul><blockquote class="book-hint info">این عدد تقریباً می‌تواند پارامتر <a href=https://azadzadeh.github.io/trojan-go/en/advance/mux/>Concurrency MUX</a> را مدل کند، هرچند از آن سختگیرانه‌تر است زیرا اینجا هر درخواست در یک TLS Session مجزا صورت می‌گیرد ولی در MUX درخواست‌های موازی درون یک TLS Session مشترک انجام می‌شوند</blockquote><ul><li>به هر درخواست فقط ۱۰ ثانیه اجازه می‌دهیم تا پاسخ بگیرد</li></ul><p>می‌توانید از این سوییچ‌ها استفاده نکنید یا oha را بدون سوئچ فراخوانی کنید.</p><p>پس از آزمایش، در گزارش به چند پارامتر توجه کنید:</p><ul><li>نرخ موفقیت (success rate) باید ۱ یا چیزی خیلی نزدیک به آن باشد</li><li>متوسط زمان پاسخ باید چیز معقولی باشد (زیر ۱ ثانیه)</li><li>در خط آخر، از n درخواست ارسالی، باید اکثراً خروجی ۲۰۰ داشته باشند</li></ul><p>اگر دامنه/آی‌پی شما این مشخصات را در آزمون نشان ندهد مثلاً آزمون timeout شود یا تعداد error response ها زیاد باشد، می‌تواند نشانگر «کثیف بودن» دامنه/آی‌پی باشد.</p><p><blockquote class="book-hint info"><p><strong>ای بابا! دامنه/IP اَم کثیف بود! (تست موفق نبود) 🥴</strong></p><p>پیش از هر کاری، در دشبورد دیتاسنتری که از آن خدمت می‌گیرید، یک VPS دیگر ایجاد کنید تا یک آی‌پی تازه به شما بدهد. دقت کنید تا پیدا کردن یک IP تمیز، هیچ VPSی را delete نکنید تا IP تکراری به شما ندهد!</p><p>بعد از ایجاد VPS جدید، باید آزمون پاکی را دوباره اجرا کنید.
یادتان باشد که در دشبورد DNS providerتان (مثلاً Cloudflare) باید آی‌پی تازه را به دامنه مربوط سازید.
بهتر است اساساً یک زیردامنه‌ی تازه هم در همینجا ایجاد کنید چرا که ممکن است زیردامنه را هدف قرار داده‌ باشند نه IP.</p></blockquote><blockquote class="book-hint info">آزمون HTTP load test مطرح شده، یک آزمون سطح بالاست. برای دقت بیشتر بهتر است از روش‌های سطح‌ پایین‌تری مثل تحلیل و مقایسه‌ی <code>tcpdump</code>ها در دو سمت کلاینت و سرور یا اجرای هوشمندانه‌ی پروب منفعلی مثل <a href=https://lcamtuf.coredump.cx/p0f3/><code>p0f</code></a> در سمت سرور استفاده کرد.</blockquote>پس از اینکه یک زوج آی‌پی/دامنه از آزمون پاکی سربلند بیرون آمدند، حالا باید یک نرم‌افزار پراکسی امن را روی سرور نصب کنید تا active probe دیگر نتواند آن را تشخیص دهد و در <em>&ldquo;لیست&rdquo;</em> بگذارد.</p><p><img src=/iran-internet/docs/guides/the-list.jpeg alt="The List"></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/Azadzadeh/iran-internet/edit/master/content/fa/docs/guides/dirty-ip.md target=_blank rel=noopener><img src=/iran-internet/svg/edit.svg class=book-icon alt=Edit>
<span>این صفحه را ویرایش کنید</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><script data-goatcounter=https://iran-internet.goatcounter.com/count async src=//gc.zgo.at/count.js></script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#بررسی-کثیف-نبودن-ip>بررسی کثیف نبودن IP</a><ul><li><a href=#لیست-و-کثیفی-ip>«لیست» و کثیفی IP</a></li><li><a href=#بررسی-مسدود-نبودن-یک-دامنهآیپی>بررسی مسدود‌ نبودن یک دامنه/آی‌پی</a></li><li><a href=#بررسی-کثیف-نبودن-یک-دامنهآیپی>بررسی کثیف‌ نبودن یک دامنه/آی‌پی</a></li></ul></li></ul></nav></div></aside></main></body></html>